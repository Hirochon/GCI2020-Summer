# Demand Forecast
第三回は独自データ(?)で行われたコンペ。なにせ初めての時系列データ。データ数もバカ多い。どうしよう(´・ω・｀)

## 結果
#### 順位: 3位 / 216人中
#### Private LB: 4.40221, Public LB: 5.8393, CV: 5.87994

## 背景
平成25年1月~平成27年9月の売り上げ(単位: 個数/日)履歴のデータから、その翌月である平成27年10月の売り上げ(単位: 個数/月)を予測する。つまり正解ラベルを作成するところから始まるw

## Model
https://github.com/Hirochon/GCI2020-Summer/blob/master/Competition3/3rd_place_solution.ipynb

## モデルの作成方針
    ・用いたデータは過去11ヶ月分
    ・LightGBM Single Model
    ・store_idを店舗ごとの売上でエンコーディング
    ・goods_genre_idを商品のPriceの平均をとってエンコーディング
    ・monthを月ごとの平均売上個数でエンコーディング
    ・月の売上がないところは0で補完
    ・goods_idとstore_idの組み合わせで過去6ヶ月のshift特徴量を作成
    ・Validationは平成27年9月分のみ

## やったこと
    ・goods_idは単純に入れたほうが精度は良かった。
    ・他IDは何かしらの情報をもたせたほうが精度は良かった。
    ・shift特徴量により精度が改善(7→6.8)
    ・shiftのずらす期間も実験したが6ヶ月がベストっぽい。
    ・学習させるデータの区間を全区間から1年に絞った結果、精度が大幅に改善(6.8→6.1)
    ・データの区間はこれ以上狭くしても精度は下がるし、これ以上広げても下がった。
    ・最初は欠損しているところは平均値埋めしていた→0埋めにしたら精度が改善(PublicLBで6を切る)
    ・移動平均はあまりスコア改善に繋がなかった。
    ・shift×移動平均という手法もとってみたが精度は下がる。
    ・id系をpriceやtargetを使ってエンコーディングしていたりしたら、best_scoreにたどり着いた。


## 上手くいかなかったこと
    ・曜日別にデータを見ていたところ購買数に明らかな偏りが出ていた。(平日に少なく、休日に多い傾向。goodsやstoreの偏りは確認してません)
    ・ここから曜日別にモデルを作成して、予測するモデルを作成しようとした。
    ・1つのNotebookで曜日ごとの予測させることもできるが、曜日ごとにNotebookを作って並列で予測させていった。(Colabはアカウント1つで最大5つまで並行でNotebookの実行が可能)
    ・(ローカルでpy形式を使って並列処理も考えたが、PCスペックが圧倒的に足りず...)
    ・それぞれ曜日ごとに予測値を使って、学習器に通してみたが、PublicLB: 6.8くらい…
    ・単純に足し算したものがPublicLB: 6.5とか…


## 反省点
    ・もっと商品に目を向けてモデル改善していくこともしたかったが、コンペ終了に近づく…。
    ・曜日も何かしら活かせると思うので、もっと良い活かし方をしたかった。
